# Методология и реализация анализа гипотез о мошенничестве

## Обзор проекта

**Дата анализа**: 11 августа 2025 г.  
**Версия фреймворка**: 2.0.0  
**Уровень значимости**: α = 0.05  
**Случайное зерно**: 42 (для воспроизводимости)

---

## 1. Цели и задачи проекта

### Основная цель
Провести комплексный статистический анализ паттернов мошеннических транзакций для выявления значимых закономерностей и разработки рекомендаций по улучшению систем обнаружения мошенничества.

### Конкретные задачи
1. **Статистическое тестирование** 6 ключевых гипотез о мошенничестве
2. **Применение коррекций** на множественные сравнения для контроля ошибок I типа
3. **Оценка экономического воздействия** выявленных закономерностей
4. **Разработка бизнес-рекомендаций** на основе статистических результатов
5. **Обеспечение воспроизводимости** всех результатов анализа

---

## 2. Описание набора данных

### Основные характеристики
- **Общий объем**: 7,483,766 транзакций
- **Количество признаков**: 34 (после инженерии признаков)
- **Общий уровень мошенничества**: 19.97% (1,495,000+ мошеннических транзакций)
- **Период анализа**: 30 сентября 2024 г. - 30 октября 2024 г.
- **Объем данных в памяти**: 8,621.50 МБ
- **Качество данных**: Отличное (отсутствуют пропущенные значения и дубликаты)

### Ключевые статистики
- **Средняя сумма легитимных транзакций**: $30,243
- **Средняя сумма мошеннических транзакций**: $118,774 (в 3.9 раза больше)
- **Пиковый час мошенничества**: 1:00 (59.26% уровень мошенничества)
- **Минимальный час мошенничества**: 18:00 (9.07% уровень мошенничества)
- **Страна с наивысшим риском**: Мексика (38.03% уровень мошенничества)

### Структура данных
- **Временные признаки**: timestamp, hour, day_of_week, day_of_month, month
- **Финансовые признаки**: amount, currency
- **Категориальные признаки**: vendor_category, vendor_type, country, card_type, channel
- **Целевая переменная**: is_fraud (бинарная)

---

## 3. Статистическая методология

### 3.1 Основные статистические тесты

#### Z-тест для пропорций
- **Применение**: Сравнение уровней мошенничества между группами
- **Условия**: Большие выборки (n > 30), биномиальное распределение
- **Формула**: z = (p₁ - p₂) / √[p(1-p)(1/n₁ + 1/n₂)]
- **Интерпретация**: |z| > 1.96 при α = 0.05 (двусторонний тест)

#### Хи-квадрат тест независимости
- **Применение**: Проверка независимости категориальных переменных
- **Условия**: Ожидаемые частоты ≥ 5 в каждой ячейке
- **Формула**: χ² = Σ[(O - E)² / E]
- **Степени свободы**: (строки - 1) × (столбцы - 1)

#### Тест Хартигана на унимодальность (Dip Test)
- **Применение**: Проверка бимодальности распределений
- **Нулевая гипотеза**: Распределение унимодально
- **Альтернативная гипотеза**: Распределение мультимодально
- **Статистика**: Максимальная разность между эмпирической и унимодальной функциями распределения

### 3.2 Размеры эффекта

#### Коэффициент Коэна h
- **Применение**: Размер эффекта для разности пропорций
- **Формула**: h = 2[arcsin(√p₁) - arcsin(√p₂)]
- **Интерпретация**: 
  - Малый эффект: |h| ≈ 0.2
  - Средний эффект: |h| ≈ 0.5
  - Большой эффект: |h| ≈ 0.8

#### Коэффициент V Крамера
- **Применение**: Размер эффекта для хи-квадрат теста
- **Формула**: V = √[χ²/(n × min(k-1, r-1))]
- **Интерпретация**: 0 ≤ V ≤ 1, где 1 означает полную ассоциацию

### 3.3 Доверительные интервалы
- **Уровень доверия**: 95% (α = 0.05)
- **Метод**: Асимптотические доверительные интервалы для пропорций
- **Формула**: p ± z₀.₀₂₅ × √[p(1-p)/n]

---

## 4. Программные библиотеки и инструменты

### 4.1 Основные статистические библиотеки
- **SciPy 1.16.0**: Базовые статистические функции и тесты
- **Statsmodels 0.14.5**: Продвинутое статистическое моделирование
- **Pingouin 0.5.5**: Удобные статистические функции с размерами эффекта
- **Diptest 0.10.0**: Тест Хартигана на унимодальность

### 4.2 Библиотеки машинного обучения
- **Scikit-learn 1.7.1**: Предобработка данных и инструменты моделирования
- **Pandas 2.3.1**: Манипуляция и анализ данных
- **NumPy 2.2.6**: Основа численных вычислений

### 4.3 Библиотеки визуализации
- **Matplotlib 3.10.5**: Основная функциональность построения графиков
- **Seaborn 0.13.2**: Статистическая визуализация данных

### 4.4 Системные библиотеки
- **Python 3.9+**: Основной язык программирования
- **Jupyter Notebook**: Интерактивная среда анализа
- **JSON**: Сохранение результатов анализа

---

## 5. Предобработка данных и инженерия признаков

### 5.1 Извлечение временных признаков
```python
# Извлечение компонентов времени
df['hour'] = df['timestamp'].dt.hour
df['day_of_week'] = df['timestamp'].dt.dayofweek
df['day_of_month'] = df['timestamp'].dt.day
df['month'] = df['timestamp'].dt.month

# Создание бинарных признаков
df['is_weekend'] = df['day_of_week'].isin([5, 6])
df['is_night'] = df['hour'].isin([0, 1, 2, 3, 4, 5])
df['is_business_hours'] = df['hour'].between(9, 17)
```

### 5.2 Обработка числовых признаков
- **Стратегия импутации**: Медиана (SimpleImputer)
- **Масштабирование**: RobustScaler (устойчив к выбросам)
- **Обнаружение выбросов**: IsolationForest (10% загрязнение)

### 5.3 Обработка категориальных признаков
- **Стратегия импутации**: Наиболее частое значение
- **Кодирование**: One-hot encoding (настраиваемое)
- **Специальная обработка**: Исключение сложных типов данных (словари)

### 5.4 Контроль качества данных
- ✅ **Отсутствие пропущенных значений** во всех 7.4M+ транзакциях
- ✅ **Отсутствие дубликатов** обеспечивает целостность данных
- ✅ **Богатый набор признаков** с 34 переменными для анализа
- ⚠️ **Высокая асимметрия сумм** (12.00) - рекомендуется логарифмическое преобразование
- ⚠️ **15.30% выбросов в суммах** - применено робастное масштабирование

---

## 6. Формулировка гипотез

### 6.1 Гипотеза 1: Временные паттерны мошенничества
- **H₀**: Уровень мошенничества в ночные часы (0-5ч) равен дневному уровню
- **H₁**: Уровень мошенничества в ночные часы значимо выше дневного
- **Тест**: Односторонний Z-тест для пропорций
- **Обоснование**: Предполагается повышенная активность мошенников ночью

### 6.2 Гипотеза 2: Эффект выходных дней
- **H₀**: Уровень мошенничества в выходные равен уровню в будни
- **H₁**: Уровень мошенничества в выходные отличается от уровня в будни
- **Тест**: Двусторонний Z-тест для пропорций
- **Обоснование**: Различные паттерны потребления в выходные

### 6.3 Гипотеза 3: Бимодальность сумм мошеннических транзакций
- **H₀**: Распределение сумм мошеннических транзакций унимодально
- **H₁**: Распределение сумм мошеннических транзакций бимодально
- **Тесты**: Тест Хартигана, хи-квадрат тесты концентрации и независимости
- **Обоснование**: Различные стратегии мошенничества для разных сумм

### 6.4 Гипотеза 4: Анализ каналов транзакций
- **H₀**: Уровень мошенничества одинаков для всех каналов
- **H₁**: Уровень мошенничества различается между каналами
- **Тест**: Хи-квадрат тест независимости
- **Обоснование**: Различная безопасность онлайн и офлайн каналов

### 6.5 Гипотеза 5: ROI машинного обучения
- **H₀**: Внедрение ML-системы не даст значимого экономического эффекта
- **H₁**: Внедрение ML-системы даст значимый экономический эффект
- **Тест**: Симуляционный анализ с доверительными интервалами
- **Обоснование**: Оценка экономической целесообразности ML-решений

### 6.6 Гипотеза 6: Эффективность динамических порогов
- **H₀**: Динамические пороги не улучшают обнаружение мошенничества
- **H₁**: Динамические пороги значимо улучшают обнаружение мошенничества
- **Тест**: Сравнение метрик производительности
- **Обоснование**: Адаптивные системы должны быть эффективнее статических

---

## 7. Коррекции на множественные сравнения

### 7.1 Проблема множественных сравнений
При тестировании нескольких гипотез одновременно увеличивается вероятность ошибки I типа (ложноположительный результат). Для контроля этой проблемы применяются специальные коррекции.

### 7.2 Примененные методы коррекции

#### Коррекция Бонферрони
- **Принцип**: Консервативная коррекция, делящая α на количество тестов
- **Скорректированный α**: α/k = 0.05/6 ≈ 0.0083
- **Преимущества**: Строгий контроль семейной ошибки I типа
- **Недостатки**: Может быть слишком консервативной

#### Коррекция ложных открытий (FDR, Benjamini-Hochberg)
- **Принцип**: Контролирует долю ложных открытий среди отклоненных гипотез
- **Процедура**: Ранжирование p-значений и применение пошаговой процедуры
- **Преимущества**: Менее консервативна, чем Бонферрони
- **Применение**: Рекомендуется для исследовательского анализа

#### Коррекция Шидака
- **Принцип**: Менее консервативная альтернатива Бонферрони
- **Формула**: α_скорр = 1 - (1 - α)^(1/k)
- **Преимущества**: Точнее Бонферрони при независимых тестах

#### Процедура Холма
- **Принцип**: Пошаговая процедура, начинающая с наименьшего p-значения
- **Преимущества**: Более мощная, чем Бонферрони
- **Применение**: Хороший компромисс между мощностью и контролем ошибок

### 7.3 Критерии оценки значимости
Гипотеза считается значимой, если она остается значимой после применения хотя бы одной из коррекций:
- **Высокая значимость**: Значима по всем методам коррекции
- **Умеренная значимость**: Значима по FDR и/или менее консервативным методам
- **Незначимая**: Не значима ни по одному методу коррекции

---

## 8. Методология визуализации и отчетности

### 8.1 Принципы визуализации
- **Публикационное качество**: Разрешение 300 DPI для всех графиков
- **Единый стиль**: Использование seaborn-v0_8 стиля
- **Цветовая схема**: Палитра "husl" для различимости
- **Размер фигур**: 15×10 дюймов для основных графиков

### 8.2 Типы визуализаций

#### Дашборд обзора мошенничества
- Общее распределение мошенничества
- Анализ сумм транзакций
- Временные паттерны
- Категориальный анализ

#### Временной анализ
- Почасовые тренды мошенничества
- Дневные паттерны
- Сравнение рабочих и нерабочих часов
- Анализ выходных дней

#### Анализ сумм
- Распределения для легитимных и мошеннических транзакций
- Перцентильный анализ
- Паттерны по валютам
- Выявление выбросов

#### Результаты тестирования гипотез
- Сводная таблица результатов
- Графики размеров эффекта
- Доверительные интервалы
- Экономическое воздействие

### 8.3 Структура отчетности
- **Исполнительное резюме**: Ключевые находки для руководства
- **Техническая документация**: Подробная методология и результаты
- **Статистический отчет**: Полные результаты всех тестов
- **Визуальные материалы**: Графики и диаграммы высокого качества

---

## 9. Обеспечение воспроизводимости

### 9.1 Контроль случайности
- **Фиксированное случайное зерно**: 42 для всех операций
- **Детерминистические алгоритмы**: Где это возможно
- **Документирование версий**: Всех используемых библиотек

### 9.2 Документирование среды
```python
# Информация о воспроизводимости
RANDOM_SEED = 42
SIGNIFICANCE_LEVEL = 0.05
ANALYSIS_DATE = "2025-01-12"
FRAMEWORK_VERSION = "2.0.0"

# Версии библиотек
PYTHON_VERSION = "3.9+"
PANDAS_VERSION = "2.3.1"
NUMPY_VERSION = "2.2.6"
SCIPY_VERSION = "1.16.0"
STATSMODELS_VERSION = "0.14.5"
```

### 9.3 Структура проекта
```
fraud_analysis_framework/
├── russian_documentation/
│   ├── 1_metodologiya_i_realizatsiya.md
│   └── 2_rezultaty_proverki_gipotez.md
├── statistical_analysis_integration.py
├── comprehensive_fraud_hypothesis_analysis.ipynb
├── fraud_analysis_framework.py
├── fraud_visualization.py
├── transaction_fraud_data.parquet
└── visualization_outputs/
```

---

## 10. Валидация и контроль качества

### 10.1 Проверки данных
- **Целостность данных**: Проверка на дубликаты и пропущенные значения
- **Логическая консистентность**: Валидация диапазонов и форматов
- **Временная согласованность**: Проверка хронологического порядка

### 10.2 Статистическая валидация
- **Проверка предположений**: Для каждого статистического теста
- **Анализ чувствительности**: К изменениям параметров
- **Кросс-валидация**: Результатов на подвыборках

### 10.3 Техническая валидация
- **Синтаксическая проверка**: Всех скриптов и ноутбуков
- **Функциональное тестирование**: Ключевых компонентов фреймворка
- **Интеграционное тестирование**: Взаимодействия между модулями

---

## Заключение

Представленная методология обеспечивает:

1. **Статистическую строгость** через применение соответствующих тестов и коррекций
2. **Воспроизводимость** через фиксацию всех параметров и версий
3. **Практическую применимость** через фокус на бизнес-значимых результатах
4. **Техническое качество** через комплексную валидацию и контроль качества

Данный подход позволяет получить надежные, статистически обоснованные выводы о паттернах мошенничества, которые могут быть использованы для улучшения систем обнаружения мошенничества и принятия обоснованных бизнес-решений.